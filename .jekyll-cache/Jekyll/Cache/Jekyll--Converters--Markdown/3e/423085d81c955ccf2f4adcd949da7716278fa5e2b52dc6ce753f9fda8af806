I"p<<blockquote>
  <p>JPAë¥¼ ì‚¬ìš©í•´ì„œ ì—”í‹°í‹°ì˜ ì¼ë¶€ ë°ì´í„°ë§Œ ê°€ì ¸ì˜¤ëŠ” Projectionì— ëŒ€í•´ì„œ ì•Œì•„ë³´ì.</p>
</blockquote>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@Data</span>
<span class="nd">@Entity</span>
<span class="nd">@Table</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Comment</span> <span class="o">{</span>

    <span class="nd">@Id</span>
    <span class="nd">@GeneratedValue</span>
    <span class="kd">private</span> <span class="nc">Long</span> <span class="n">id</span><span class="o">;</span>
    <span class="kd">private</span> <span class="nc">String</span> <span class="n">comment</span><span class="o">;</span>

    <span class="nd">@ManyToOne</span><span class="o">(</span><span class="n">fetch</span> <span class="o">=</span> <span class="nc">FetchType</span><span class="o">.</span><span class="na">LAZY</span><span class="o">)</span>
    <span class="kd">private</span> <span class="nc">Post</span> <span class="n">post</span><span class="o">;</span>

    <span class="kd">private</span> <span class="kt">int</span> <span class="n">up</span><span class="o">;</span>
    <span class="kd">private</span> <span class="kt">int</span> <span class="n">down</span><span class="o">;</span>
    <span class="kd">private</span> <span class="kt">boolean</span> <span class="n">best</span><span class="o">;</span>

    <span class="kd">private</span> <span class="nc">String</span> <span class="n">votes</span><span class="o">;</span>

<span class="o">}</span>
</code></pre></div></div>

<p>ë‹¤ìŒê³¼ ê°™ì€ Comment ì—”í‹°í‹°ê°€ ì¡´ì¬í•œë‹¤.</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">public</span> <span class="kd">interface</span> <span class="nc">CommentSummary</span> <span class="o">{</span>

    <span class="nc">String</span> <span class="nf">getComment</span><span class="o">();</span>

    <span class="kt">int</span> <span class="nf">getUp</span><span class="o">();</span>

    <span class="kt">int</span> <span class="nf">getDown</span><span class="o">();</span>
<span class="o">}</span>
</code></pre></div></div>

<p>í•„ìš”í•œ ì¼ë¶€ ë°ì´í„°ë§Œì„ ë‹´ì€ <code class="language-plaintext highlighter-rouge">CommentSummary</code> ì¸í„°í˜ì´ìŠ¤ë¥¼ ë§Œë“ ë‹¤.</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@Repository</span>
<span class="kd">public</span> <span class="kd">interface</span> <span class="nc">CommentRepository</span> <span class="kd">extends</span> <span class="nc">JpaRepository</span><span class="o">&lt;</span><span class="nc">Comment</span><span class="o">,</span> <span class="nc">Long</span><span class="o">&gt;</span> <span class="o">{</span>

    <span class="nc">List</span><span class="o">&lt;</span><span class="nc">Comment</span><span class="o">&gt;</span> <span class="nf">findByPost_Id</span><span class="o">(</span><span class="nc">Long</span> <span class="n">id</span><span class="o">);</span>
<span class="o">}</span>
</code></pre></div></div>

<p>ë¨¼ì € commentì˜ idë¥¼ í†µí•´ì„œ Postë¥¼ ì°¾ëŠ” ì¿¼ë¦¬ë©”ì„œë“œë¥¼ ë§Œë“¤ê³  í…ŒìŠ¤íŠ¸ë¥¼ ëŒë ¤ë³´ì.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Hibernate:
    select
        comment0_.id as id1_0_,
        comment0_.best as best2_0_,
        comment0_.comment as comment3_0_,
        comment0_.down as down4_0_,
        comment0_.post_id as post_id7_0_,
        comment0_.up as up5_0_,
        comment0_.votes as votes6_0_
    from
        comment comment0_
    left outer join
        post post1_
            on comment0_.post_id=post1_.id
    where
        post1_.id=?
</code></pre></div></div>

<p>ì¼ë°˜ì ìœ¼ë¡œ <code class="language-plaintext highlighter-rouge">Comment</code> ì—”í‹°í‹°ì— ì •ì˜í•œ ëª¨ë“  í•„ë“œë¥¼ ë‹¤ ê°€ì§€ê³  ì˜¨ë‹¤.</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    <span class="nc">List</span><span class="o">&lt;</span><span class="nc">CommentSummary</span><span class="o">&gt;</span> <span class="nf">findByPost_Id</span><span class="o">(</span><span class="nc">Long</span> <span class="n">id</span><span class="o">);</span> <span class="c1">// List íƒ€ì…ì„ CommentSummaryë¡œ ë³€ê²½</span>
</code></pre></div></div>

<p>ì´ë ‡ê²Œ ë°”ê¾¸ê³  í…ŒìŠ¤íŠ¸ ì¼€ì´ìŠ¤ë¥¼ ëŒë¦¬ë©´ ë‹¤ìŒê³¼ ê°™ì´ interfaceì—ì„œ ì •ì˜í•œ í•„ë“œ 3ê°œë§Œ ì¿¼ë¦¬ë¬¸ì´ ì‹¤í–‰ë¨ì„ ì•Œ ìˆ˜ ìˆë‹¤.(ìµœì í™”)</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Hibernate:
    select
        comment0_.comment as col_0_0_,
        comment0_.up as col_1_0_,
        comment0_.down as col_2_0_
    from
        comment comment0_
    left outer join
        post post1_
            on comment0_.post_id=post1_.id
    where
        post1_.id=?
</code></pre></div></div>

<h2 id="open-projection-close-projection">Open Projection, Close Projection</h2>

<p>OpenProjectionì€ @Value (ë¡¬ë³µêº¼ ì•„ë‹˜)ì™€ SpELë¥¼ ì‚¬ìš©í•´ì„œ target(ì—¬ê¸°ì„œëŠ” Comment entity)ì˜ í•„ë“œë¥¼ ìƒˆë¡­ê²Œ ê°€ê³µí•œ ê°’ì„ ê°€ì ¸ë‹¤ê°€ ì‚¬ìš©í•  ìˆ˜ ìˆë‹¤. í•˜ì§€ë§Œ ì „ì²´ í•„ë“œ(ê·¸ë˜ì„œ Open Projectionì„) ì— ëŒ€í•œ ì¿¼ë¦¬ê°€ ë‚ ì•„ê°€ê¸° ë•Œë¬¸ì— ìµœì í™”ëŠ” ë˜ì§€ ì•ŠëŠ”ë‹¤.</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">public</span> <span class="kd">interface</span> <span class="nc">CommentSummary</span> <span class="o">{</span>

        <span class="nc">String</span> <span class="nf">getComment</span><span class="o">();</span>

    <span class="kt">int</span> <span class="nf">getUp</span><span class="o">();</span>

    <span class="kt">int</span> <span class="nf">getDown</span><span class="o">();</span>

    <span class="nd">@Value</span><span class="o">(</span><span class="s">"#{target.up + ' ' +target.down}"</span><span class="o">)</span>
    <span class="nc">String</span> <span class="nf">getVotes</span><span class="o">();</span>

<span class="o">}</span>
</code></pre></div></div>

<p>ì•ì—ì„œ ì‚´í´ë³¸ CommentSummaryì— getVotes()ë¥¼ ì¶”ê°€í•˜ê³ , @Value (<code class="language-plaintext highlighter-rouge">import org.springframework.beans.factory.annotation.Value;</code>) ì™€ SpELë¥¼ ì‚¬ìš©í•´ì„œ targetì˜ upê³¼ + targetì˜ downì„ ë¬¸ìì—´ê³¼ í•©ì¹˜ëŠ” ì—°ì‚°ì„ í•˜ë„ë¡ ë§Œë“¤ì—ˆë‹¤.</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code>        <span class="nd">@Test</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">getComment</span><span class="o">()</span> <span class="o">{</span>

        <span class="nc">Post</span> <span class="n">post</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Post</span><span class="o">();</span>
        <span class="n">post</span><span class="o">.</span><span class="na">setTitle</span><span class="o">(</span><span class="s">"jpa"</span><span class="o">);</span>
        <span class="nc">Post</span> <span class="n">savedPost</span> <span class="o">=</span> <span class="n">postRepository</span><span class="o">.</span><span class="na">save</span><span class="o">(</span><span class="n">post</span><span class="o">);</span>

        <span class="nc">Comment</span> <span class="n">comment</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Comment</span><span class="o">();</span>
        <span class="n">comment</span><span class="o">.</span><span class="na">setComment</span><span class="o">(</span><span class="s">"hello jpa"</span><span class="o">);</span>
        <span class="n">comment</span><span class="o">.</span><span class="na">setUp</span><span class="o">(</span><span class="mi">10</span><span class="o">);</span>
        <span class="n">comment</span><span class="o">.</span><span class="na">setDown</span><span class="o">(</span><span class="mi">1</span><span class="o">);</span>
        <span class="n">comment</span><span class="o">.</span><span class="na">setPost</span><span class="o">(</span><span class="n">savedPost</span><span class="o">);</span>
        <span class="n">commentRepository</span><span class="o">.</span><span class="na">save</span><span class="o">(</span><span class="n">comment</span><span class="o">);</span>

        <span class="n">commentRepository</span><span class="o">.</span><span class="na">findByPost_Id</span><span class="o">(</span><span class="mi">1L</span><span class="o">).</span><span class="na">stream</span><span class="o">().</span><span class="na">forEach</span><span class="o">(</span><span class="n">c</span> <span class="o">-&gt;</span> <span class="o">{</span>
                    <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">" ============================= "</span><span class="o">);</span>
                    <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">c</span><span class="o">.</span><span class="na">getVotes</span><span class="o">());</span>
                <span class="o">}</span>
        <span class="o">);</span>
    <span class="o">}</span>
</code></pre></div></div>

<p>Postì™€ Commentë¥¼ ê°ê° ë§Œë“¤ì–´ì„œ ì €ì¥í•˜ê³ (ì—°ê´€ê´€ê³„ ì„¤ì •í•¨), ê·¸ë¦¬ê³  <code class="language-plaintext highlighter-rouge">commentId</code> ë¡œ ì¡°íšŒí•´ì„œ getVotes()ì˜ ì–´ë–¤ ê°’ì´ ë“¤ì–´ê°€ëŠ”ì§€ ì‚´í´ë³´ì.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Hibernate:
    select
        comment0_.id as id1_0_,
        comment0_.best as best2_0_,
        comment0_.comment as comment3_0_,
        comment0_.down as down4_0_,
        comment0_.post_id as post_id7_0_,
        comment0_.up as up5_0_,
        comment0_.votes as votes6_0_
    from
        comment comment0_
    left outer join
        post post1_
            on comment0_.post_id=post1_.id
    where
        post1_.id=?
 =============================
10 1

</code></pre></div></div>

<p>ê²°ê³¼ë¥¼ ë³´ë©´, ì¼ë‹¨ ì¿¼ë¦¬ê°€ ì „ì²´ í•„ë“œì— ëŒ€í•´ì„œ ë‚ ì•„ê°„ë‹¤. ê·¸ë¦¬ê³  ì›í–ˆë˜ ì—°ì‚°ì˜ ê²°ê³¼ê°€ ì°í˜”ë‹¤. ê·¸ëŸ¼ ê¸°ì¡´ì˜ Closed (ì œí•œì ì¸) Projectionì„ í•˜ë©´ì„œ ì—°ì‚°í•  ìˆ˜ ìˆëŠ” ë°©ë²•ì´ ìˆì§€ ì•Šì„ê¹Œ? ğŸ¤”</p>

<h3 id="java8-ë¶€í„°-ë„ì…ëœ-default-methodë¥¼-í™œìš©í•˜ëŠ”-ê²ƒ">Java8 ë¶€í„° ë„ì…ëœ default Methodë¥¼ í™œìš©í•˜ëŠ” ê²ƒ</h3>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">public</span> <span class="kd">interface</span> <span class="nc">CommentSummary</span> <span class="o">{</span>

        <span class="o">...</span><span class="na">ìƒëµ</span>

    <span class="k">default</span> <span class="nc">String</span> <span class="nf">getVotes</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="nf">getUp</span><span class="o">()</span> <span class="o">+</span> <span class="s">" "</span> <span class="o">+</span> <span class="n">getDown</span><span class="o">();</span>
    <span class="o">}</span>

<span class="o">}</span>

</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Hibernate:
    select
        comment0_.comment as col_0_0_,
        comment0_.up as col_1_0_,
        comment0_.down as col_2_0_
    from
        comment comment0_
    left outer join
        post post1_
            on comment0_.post_id=post1_.id
    where
        post1_.id=?
 =============================
10 1

</code></pre></div></div>

<p>ìœ„ì˜ ê²°ê³¼ì™€ ë‹¤ë¥´ê²Œ, ë”± 3ê°œì˜ í•„ë“œë¥¼ ì¡°íšŒí•˜ëŠ” ì¿¼ë¦¬ì™€, ì•„ë˜ì— ì—°ì‚° ê²°ê³¼ê¹Œì§€ ì™„ë²½í•˜ë‹¤!</p>

<h2 id="ë‹¤ì´ë‚˜ë¯¹-í”„ë¡œì ì…˜">ë‹¤ì´ë‚˜ë¯¹ í”„ë¡œì ì…˜</h2>

<blockquote>
  <p>ë§Œì•½ì— ìš”êµ¬ ì‚¬í•­ì´ CommentSummary ë¿ë§Œ ì•„ë‹ˆë¼, CommentOnly(ì˜¤ì§ ì½”ë©˜íŠ¸ë§Œ ì°¾ëŠ” ì¿¼ë¦¬ë¥¼ ë‚ ë¦¬ë„ë¡ í•œë‹¤ë©´)</p>
</blockquote>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@Repository</span>
<span class="kd">public</span> <span class="kd">interface</span> <span class="nc">CommentRepository</span> <span class="kd">extends</span> <span class="nc">JpaRepository</span><span class="o">&lt;</span><span class="nc">Comment</span><span class="o">,</span> <span class="nc">Long</span><span class="o">&gt;</span> <span class="o">{</span>

    <span class="nc">List</span><span class="o">&lt;</span><span class="nc">CommnetSummary</span><span class="o">&gt;</span> <span class="nf">findByPost_Id</span><span class="o">(</span><span class="nc">Long</span> <span class="n">id</span><span class="o">);</span>
    <span class="nc">List</span><span class="o">&lt;</span><span class="nc">CommnetOnly</span><span class="o">&gt;</span> <span class="nf">findByPost_Id</span><span class="o">(</span><span class="nc">Long</span> <span class="n">id</span><span class="o">);</span>
<span class="o">}</span>

</code></pre></div></div>

<p>ì´ë ‡ê²Œ í•˜ê³  ì‹¶ì§€ë§Œ, ì‚¬ìš©í•  ìˆ˜ ì—†ë‹¤. ê·¸ë˜ì„œ í´ë˜ìŠ¤ì˜ íƒ€ì…ì„ íŒŒë¼ë¯¸í„°ë¡œ ë„˜ê¸°ëŠ” Genericë¥¼ í™œìš©í•´ì„œ ë³€ê²½í•  ìˆ˜ ìˆë‹¤.</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@Repository</span>
<span class="kd">public</span> <span class="kd">interface</span> <span class="nc">CommentRepository</span> <span class="kd">extends</span> <span class="nc">JpaRepository</span><span class="o">&lt;</span><span class="nc">Comment</span><span class="o">,</span> <span class="nc">Long</span><span class="o">&gt;</span> <span class="o">{</span>

    <span class="o">&lt;</span><span class="no">T</span><span class="o">&gt;</span> <span class="nc">List</span><span class="o">&lt;</span><span class="no">T</span><span class="o">&gt;</span> <span class="nf">findByPost_Id</span><span class="o">(</span><span class="nc">Long</span> <span class="n">id</span><span class="o">,</span> <span class="nc">Class</span><span class="o">&lt;</span><span class="no">T</span><span class="o">&gt;</span> <span class="n">type</span><span class="o">);</span>
<span class="o">}</span>

</code></pre></div></div>

<h2 id="ì •ë¦¬">ì •ë¦¬</h2>

<p>ì—”í‹°í‹°ì˜ íŠ¹ì • ë°ì´í„°ë§Œì„ ì¡°íšŒí•˜ëŠ”(ìµœì í™”) Projectionì— ëŒ€í•´ì„œ ì•Œì•„ë´¤ë‹¤. ì˜ˆì œì—ì„œëŠ” Interfaceë¥¼ í†µí•´ì„œ Projectionì„ í–ˆì§€ë§Œ í´ë˜ìŠ¤ê¸°ë°˜(DTO)ë¥¼ í†µí•´ì„œë„ í•  ìˆ˜ ìˆë‹¤. í´ë˜ìŠ¤ê¸°ë°˜ì€ ì½”ë“œì˜ ì–‘ì´ ë§ì•„ì§„ë‹¤.(ë¡¬ë³µìœ¼ë¡œ ì¤„ì¼ ìˆ˜ ìˆì§€ë§Œ). íŠ¹ì • ì¿¼ë¦¬ì—ì„œ ì—°ì‚°í•œ ê²°ê³¼ë¥¼ ë°›ì„ ìˆ˜ë„ ìˆì—ˆë‹¤. (Open Projection vs Closed Projection) Openì€ ë§ ê·¸ëŒ€ë¡œ target.fieldë¥¼ í•˜ê¸° ë•Œë¬¸ì— targetì— í•´ë‹¹í•˜ëŠ” ì—”í‹°í‹° ì „ì²´ë¥¼ ì¡°íšŒí•œë‹¤. ê·¸ë˜ì„œ ìµœì í™”ëŠ” ë¬´ì˜ë¯¸. ê·¸ë˜ì„œ default ë©”ì„œë“œë¥¼ í†µí•´ì„œ ëŒ€ì²´ í•  ìˆ˜ ìˆì—ˆë‹¤.</p>

<p>ë§ˆì§€ë§‰ìœ¼ë¡œ, ì—¬ëŸ¬ ìš”êµ¬ ì‚¬í•­ì— ë§ëŠ” DTOí´ë˜ìŠ¤, í˜¹ì€ ì¸í„°í˜ì´ìŠ¤ë¥¼ ë§Œë“¤ì—ˆì„ ë•Œ ì¤‘ë³µì´ ë°œìƒí•˜ê¸° ë•Œë¬¸ì— í´ë˜ìŠ¤ì˜ íƒ€ì…ì„ íŒŒë¼ë¯¸í„°ë¡œ ë„˜ê²¨ì„œ ì œë„¤ë¦­ìœ¼ë¡œ ë§Œë“¤ì–´ì„œ ì‚¬ìš©í•˜ëŠ” ë°©ë²•ì„ ì•Œì•„ë´¤ë‹¤.</p>
:ET